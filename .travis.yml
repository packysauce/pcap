language: rust
sudo: false
addons:
  apt:
    packages: [libpcap0.8, libpcap0.8-dev]
matrix:
  include:
    - {os: linux, rust: stable,
       env: FLAGS="--features stream"}
    - {os: linux, rust: beta,
       env: FLAGS="--features stream"}
    - {os: linux, rust: nightly,
       env: FLAGS="--features stream"
            CLIPPY=1}
    - {os: osx, rust: stable,
       env: FLAGS="--features full" PCAP_LIBDIR=/usr/local/opt/libpcap/lib}
    - {os: osx, rust: beta,
       env: FLAGS="--features full" PCAP_LIBDIR=/usr/local/opt/libpcap/lib}
    - {os: osx, rust: nightly,
       env: FLAGS="--all-features" PCAP_LIBDIR=/usr/local/opt/libpcap/lib}
before_install:
  - if [ `uname` = "Darwin" ]; then
      brew update >/dev/null;
      brew install libpcap;
    fi
  - rustup component add clippy-preview
script:
  - cargo clippy -v $FLAGS
  - cargo build -v $FLAGS 
  - cargo test  -v $FLAGS
  - cargo doc --no-deps
  - if [ -n "$CLIPPY" ]; then cargo clippy -v $FLAGS; fi
